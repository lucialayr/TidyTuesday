area_ha = st_area(geometry)/10000) %>%
dplyr::select(FIRE_NAME, YEAR_, min_RBR, max_RBR, mean_RBR, sd_RBR, area_ha)
#  Combine
full_fire_history <- bind_rows(burned_stats, unburned_stats)
# Plot:
# plot(full_fire_history["FIRE_NAME"])
# Drop geometry and fix the NA‐row
full_fire_history_table <- full_fire_history %>%
st_set_geometry(NULL) %>%
mutate(YEAR_  = if_else(is.na(YEAR_), 0L, YEAR_),
FIRE_NAME = if_else(is.na(FIRE_NAME), "Unburned", FIRE_NAME))
#Write
#write_csv(full_fire_history_table, "outputs/severity_fire_history.csv")
# Display
knitr::kable(
full_fire_history_table)
# overlay veg × fire
veg_hist <- st_intersection(
merged_units_veg["MapUnit_Name"],
burned_overlap[c("FIRE_NAME","YEAR_")]
)
# compute per‐polygon RBR stats (still sf)
veg_hist_stats <- veg_hist %>%
mutate(min_RBR   = exact_extract(rbr_to_vec_crs, ., "min",progress = FALSE),
max_RBR   = exact_extract(rbr_to_vec_crs, ., "max",progress = FALSE),
mean_RBR  = exact_extract(rbr_to_vec_crs, ., "mean",progress = FALSE),
sd_RBR    = exact_extract(rbr_to_vec_crs, ., "stdev",progress = FALSE),
area_ha   = as.numeric(st_area(.)) / 10000)
# build the “previously unburned” pieces
burned_union  <- st_union(burned_overlap)
veg_unburned  <- st_difference(merged_units_veg, burned_union) %>%
filter(!st_is_empty(.))
# compute stats on unburned (still sf)
veg_unburned_stats <- veg_unburned %>%
mutate(min_RBR = exact_extract(rbr_to_vec_crs, ., "min",progress = FALSE),
max_RBR = exact_extract(rbr_to_vec_crs, ., "max",progress = FALSE),
mean_RBR  = exact_extract(rbr_to_vec_crs, ., "mean",progress = FALSE),
sd_RBR = exact_extract(rbr_to_vec_crs, ., "stdev",progress = FALSE),
area_ha = as.numeric(st_area(.)) / 10000,
FIRE_NAME = "Previously Unburned",YEAR_ = 0L)
#  bind burned + unburned
full_veg_history <- bind_rows(veg_hist_stats, veg_unburned_stats) %>%
mutate(MapUnit_Name = factor(MapUnit_Name, levels = ordered_veg, ordered = TRUE),
FIRE_NAME = factor(FIRE_NAME, levels = c("WHISPERING PINES","COVINGTON","Previously Unburned"), ordered = TRUE)) %>%
arrange(MapUnit_Name, FIRE_NAME)%>%
st_set_geometry(NULL)
#Write
#write_csv(full_veg_history, "outputs/severity_veg_firehist.csv")
#show
knitr::kable(
full_veg_history)
# burned pixels
burned_vals <- exact_extract(rbr_to_vec_crs,veg_hist %>%
dplyr::select(MapUnit_Name, FIRE_NAME),
include_cols = c("MapUnit_Name","FIRE_NAME"),
progress = FALSE) %>%
bind_rows() %>%
filter(!is.na(value))
# unburned pixels
unburn_vals <- exact_extract(rbr_to_vec_crs, veg_unburned %>%
dplyr::select(MapUnit_Name), include_cols = "MapUnit_Name", progress = FALSE) %>%
bind_rows() %>%
filter(!is.na(value)) %>%
mutate(FIRE_NAME = "Previously Unburned")
# combine & factor
all_vals <- bind_rows(burned_vals, unburn_vals) %>%
mutate(MapUnit_Name = factor(MapUnit_Name, levels = ordered_veg, ordered = TRUE),
FIRE_NAME = factor(
FIRE_NAME,
levels = c("WHISPERING PINES","COVINGTON","Previously Unburned"),
ordered = TRUE))
#remove 'association' from unit names
ordered_veg_clean <- ordered_veg %>%
str_remove_all("Association") %>%
str_squish()
all_vals_ordered <- all_vals %>%
mutate(MapUnit_Name = str_squish(str_remove_all(MapUnit_Name, "Association")), MapUnit_Name = factor(MapUnit_Name, levels = ordered_veg_clean, ordered = TRUE))
# build legend labels
legend_labs <- c("WHISPERING PINES" = sprintf("Whispering Pines (19 yrs)"),
"COVINGTON" = sprintf("Covington (30 yrs)"),
"Previously Unburned" = "Previously Unburned (>55 yrs)")
ggplot(all_vals_ordered, aes(x= value, y = MapUnit_Name, fill = FIRE_NAME)) +
geom_density_ridges(scale = 1.0, rel_min_height  = 0.01, trim = FALSE,
colour = "grey30", alpha = 0.8, size = 0.2) +
geom_jitter(aes(x = value, y = MapUnit_Name), height = 0.025,
size = .5, stroke = 0, shape = 20) +
coord_flip() +
scale_x_continuous(name = " Relative Burn Ratio (RBR)",
breaks = seq(-0.1, 0.6, by = 0.2), limits = c(-0.1, 0.55)) +
scale_y_discrete(name = NULL, labels = function(x) str_wrap(x, 25)) +
scale_fill_viridis_d(name = "Fire History", option  = "magma", begin = 0.2,
end = 0.8, labels = legend_labs) +
labs(title = "Fire Severity Distribution by Vegetation Type × Fire History") +
theme_minimal(base_size = 12) +
theme(axis.text.x  = element_text(angle = 45, hjust = 1),
axis.text.y = element_text(size = 10),
panel.grid.major = element_line(color = "grey80", linetype = "dashed"),
panel.grid.minor = element_blank(),
plot.title = element_text(face = "bold", hjust = 0.5),
legend.position = "bottom",
legend.background = element_rect(fill = "white", color = "grey80"))
library(stars)
library(tidyverse)
setwd("~/Desktop/NPS/SpectralUnmixing/ExploratoryJOTR")
(file_list = list.files(paste0('PlanetBaseMaps2024_global_monthly_mosaic/'), pattern = paste0("\\", ".tif$"), full.names = FALSE))
maps = stars::read_stars(paste0('PlanetBaseMaps2024_global_monthly_mosaic/', file_list[1]))
file_list = list.files(paste0('PlanetBaseMaps2024_global_monthly_mosaic/'), pattern = paste0("\\", ".tif$"), full.names = FALSE)
maps = stars::read_stars(paste0('PlanetBaseMaps2024_global_monthly_mosaic/', file_list[1]))
ggplot() + theme_void() +
geom_spatial_rgb(data = maps, aes(x = x, y = y, r = red, g = green, b = blue))
library(terrainr)
ggplot() + theme_void() +
geom_spatial_rgb(data = maps, aes(x = x, y = y, r = red, g = green, b = blue))
maps
rast = teraa::rast(paste0('PlanetBaseMaps2024_global_monthly_mosaic/', file_list[1]))
rast = terra::rast(paste0('PlanetBaseMaps2024_global_monthly_mosaic/', file_list[1]))
library(stars)
library(tidyverse)
library(terrainr)
setwd("~/Desktop/NPS/SpectralUnmixing/ExploratoryJOTR")
rast = terra::rast(paste0('PlanetBaseMaps2024_global_monthly_mosaic/', file_list[1]))
setwd("~/Desktop/NPS/SpectralUnmixing/ExploratoryJOTR")
rast = terra::rast(paste0('PlanetBaseMaps2024_global_monthly_mosaic/', file_list[1]))
rast = terra::rast(paste0('PlanetBaseMaps2024_global_monthly_mosaic/', file_list[1]))
plotRGB(rast)
terra::plotRGB(rast)
maps = terra::rast(paste0('PlanetBaseMaps2024_global_monthly_mosaic/', file_list[1]))
terra::plotRGB(maps)
maps = terra::rast(paste0('PlanetBaseMaps2024_global_monthly_mosaic/', file_list))
library(terra)
library(tidyverse)
setwd("~/Desktop/NPS/SpectralUnmixing/ExploratoryJOTR")
file_list
r1 = terra::rast(paste0('PlanetBaseMaps2024_global_monthly_mosaic/', file_list[1]))
r2 = terra::rast(paste0('PlanetBaseMaps2024_global_monthly_mosaic/', file_list[1]))
r = terra::mosaic(r1, r2)
plotRGB(r)
r2 = terra::rast(paste0('PlanetBaseMaps2024_global_monthly_mosaic/', file_list[2]))
r = terra::mosaic(r1, r2)
plotRGB(r)
r1 = terra::rast(paste0('PlanetBaseMaps2024_global_monthly_mosaic/', file_list[1]))
r2 = terra::rast(paste0('PlanetBaseMaps2024_global_monthly_mosaic/', file_list[2]))
r3 = terra::rast(paste0('PlanetBaseMaps2024_global_monthly_mosaic/', file_list[3]))
r4 = terra::rast(paste0('PlanetBaseMaps2024_global_monthly_mosaic/', file_list[4]))
r = terra::mosaic(r1, r2, r3, r4)
plotRGB(r)
library(sf)
library(tidyverse)
setwd("~/Desktop/NPS/SpectralUnmixing/ExploratoryJOTR")
alliances  = st_read('jotrgeodata.gpkg', layer = 'JOTR_VegPolys', quiet = T)
#sort(unique(alliances$MapUnit_Name))
alliance_of_interest = c("Red Brome - Mediterranean Grass Semi-Natural Herbaceous Stands",
"Singleleaf Pinyon / Muller Oak Woodland Association",
"Creosote Bush - Brittlebush - White Bursage Shrubland Association",
"Joshua Tree / Creosote Bush - Mojave Yucca / Big Galleta Woodland Association")
subset = alliances %>%
filter(MapUnit_Name %in% alliance_of_interest) %>%
group_by(MapUnit_Name) %>%
summarize(area = sum(Hectares))
create_sample_points = function(aoi) {
alliances  = st_read('jotrgeodata.gpkg', layer = 'JOTR_VegPolys', quiet = T)
subset = alliances %>%
filter(MapUnit_Name == aoi) %>%
group_by(MapUnit_Name) %>%
summarize(area = sum(Hectares))
points = st_sample(subset, size = 100, type = "random", by_polygon = F) %>%
st_as_sf %>%
mutate(MapUnit_Name = aoi)
return(points)
}
points = lapply(alliance_of_interest, create_sample_points) %>%
bind_rows()
points_df = points %>%
st_transform(4326) %>%
mutate(Lon = st_coordinates(x)[, 1],
Lat = st_coordinates(x)[, 2],
start_date = '2010-01-01',
end_date = '2010-12-31') %>%
st_drop_geometry()
write_csv(points_df, 'sample_points_tap.csv')
(ggplot() + theme_bw() +
geom_sf(data = subset, aes(fill = MapUnit_Name), color = NA, alpha = .25) +
geom_sf(data = points, aes(color = MapUnit_Name), shape = 3) +
theme(legend.position = 'bottom',
legend.direction = 'vertical'))
r1 = terra::rast(paste0('PlanetBaseMaps2024_global_monthly_mosaic/', file_list[1]))
r2 = terra::rast(paste0('PlanetBaseMaps2024_global_monthly_mosaic/', file_list[2]))
r3 = terra::rast(paste0('PlanetBaseMaps2024_global_monthly_mosaic/', file_list[3]))
r4 = terra::rast(paste0('PlanetBaseMaps2024_global_monthly_mosaic/', file_list[4]))
r = terra::mosaic(r1, r2, r3, r4)
plotRGB(r)
lines(points_df, col = "red", lwd = 2)
r
points_df
lines(points_df, col = "red")
plotRGB(r)
lines(points_df, col = "red")
plotRGB(r)
lines(points_df, col = "red")
alliances  = st_read('jotrgeodata.gpkg', layer = 'JOTR_VegPolys', quiet = T) %>%
filter(MapUnit_Name %in% alliance_of_interest) %>%
st_transform("EPSG:4326") %>%
st_make_valid() %>%
mutate(X_Centroid = st_coordinates(st_centroid(SHAPE))[, 1],
Y_Centroid = st_coordinates(st_centroid(SHAPE))[, 2]) %>%
filter(X_Centroid < -116) %>%
st_union() %>%
st_buffer(1000)
(ggplot() + theme_bw() +
geom_sf(data = alliances, aes(), color = NA, alpha = .5) +
theme(legend.position = 'bottom',
legend.direction = 'vertical'))
st_write(alliances, 'aoi_planet.shp')
lines(aliances, col = "red")
plotRGB(r)
lines(aliances, col = "red")
plotRGB(r)
lines(alliances, col = "red")
alliances
file_list[1]
file_list[2]
file_list[3]
file_list[4]
stich_monthy_tile = function(month) {
r1 = terra::rast(paste0('PlanetBaseMaps2024_global_monthly_mosaic/', month, '-0361E-1229N.tif'))
r2 = terra::rast(paste0('PlanetBaseMaps2024_global_monthly_mosaic/', month, '-0361E-1230N.tif'))
r3 = terra::rast(paste0('PlanetBaseMaps2024_global_monthly_mosaic/', month, '-0362E-1229N.tif'))
r4 = terra::rast(paste0('PlanetBaseMaps2024_global_monthly_mosaic/', month, '-0362E-1230N.tif'))
r = terra::mosaic(r1, r2, r3, r4)
writeRaster(r, paste0('PlanetBaseMaps2024_global_monthly_mosaic/', month, '_stiched.tif'))
}
stich_monthy_tile = function(month) {
r1 = terra::rast(paste0('PlanetBaseMaps2024_global_monthly_mosaic/', month, '-0361E-1229N.tif'))
r2 = terra::rast(paste0('PlanetBaseMaps2024_global_monthly_mosaic/', month, '-0361E-1230N.tif'))
r3 = terra::rast(paste0('PlanetBaseMaps2024_global_monthly_mosaic/', month, '-0362E-1229N.tif'))
r4 = terra::rast(paste0('PlanetBaseMaps2024_global_monthly_mosaic/', month, '-0362E-1230N.tif'))
r = terra::mosaic(r1, r2, r3, r4)
writeRaster(r, paste0('PlanetBaseMaps2024_global_monthly_mosaic/', month, '_stiched.tif'))
}
for month in c('2024-01', '2024-02', '2024-03', '2024-04', '2024-05', '2024-06', '2024-07', '2024-08', '2024-09', '2024-10', '2024-11', '2024-12')) {
stich_monthy_tile = function(month) {
r1 = terra::rast(paste0('PlanetBaseMaps2024_global_monthly_mosaic/', month, '-0361E-1229N.tif'))
r2 = terra::rast(paste0('PlanetBaseMaps2024_global_monthly_mosaic/', month, '-0361E-1230N.tif'))
r3 = terra::rast(paste0('PlanetBaseMaps2024_global_monthly_mosaic/', month, '-0362E-1229N.tif'))
r4 = terra::rast(paste0('PlanetBaseMaps2024_global_monthly_mosaic/', month, '-0362E-1230N.tif'))
r = terra::mosaic(r1, r2, r3, r4)
writeRaster(r, paste0('PlanetBaseMaps2024_global_monthly_mosaic/', month, '_stiched.tif'))
}
for (month in c('2024-01', '2024-02', '2024-03', '2024-04', '2024-05', '2024-06', '2024-07', '2024-08', '2024-09', '2024-10', '2024-11', '2024-12')) {
stich_monthy_tile(month)
}
file_list
stich_monthy_tile = function(month) {
r1 = terra::rast(paste0('PlanetBaseMaps2024_global_monthly_mosaic/', month, '-0361E-1229N.tif'))
r2 = terra::rast(paste0('PlanetBaseMaps2024_global_monthly_mosaic/', month, '-0361E-1230N.tif'))
r3 = terra::rast(paste0('PlanetBaseMaps2024_global_monthly_mosaic/', month, '-0362E-1229N.tif'))
r4 = terra::rast(paste0('PlanetBaseMaps2024_global_monthly_mosaic/', month, '-0362E-1230N.tif'))
r = terra::mosaic(r1, r2, r3, r4)
writeRaster(r, paste0('PlanetBaseMaps2024_global_monthly_mosaic/', month, '_stiched.tif'))
}
for (month in c('2501', '2502', '2503', '2504', '2505', '2506', '2507', '2508', '2509', '2510', '2511', '2512')) {
stich_monthy_tile(month)
}
stich_monthy_tile = function(month) {
r1 = terra::rast(paste0('PlanetBaseMaps2024_global_monthly_tiles/', month, '-0361E-1229N.tif'))
r2 = terra::rast(paste0('PlanetBaseMaps2024_global_monthly_tiles/', month, '-0361E-1230N.tif'))
r3 = terra::rast(paste0('PlanetBaseMaps2024_global_monthly_tiles/', month, '-0362E-1229N.tif'))
r4 = terra::rast(paste0('PlanetBaseMaps2024_global_monthly_tiles/', month, '-0362E-1230N.tif'))
r = terra::mosaic(r1, r2, r3, r4)
writeRaster(r, paste0('PlanetBaseMaps2024_global_monthly_mosaic/', month, '_stiched.tif'))
}
for (month in c('2501', '2502', '2503', '2504', '2505', '2506', '2507', '2508', '2509', '2510', '2511', '2512')) {
stich_monthy_tile(month)
}
?writeRaster
stich_monthy_tile = function(month) {
r1 = terra::rast(paste0('PlanetBaseMaps2024_global_monthly_tiles/', month, '-0361E-1229N.tif'))
r2 = terra::rast(paste0('PlanetBaseMaps2024_global_monthly_tiles/', month, '-0361E-1230N.tif'))
r3 = terra::rast(paste0('PlanetBaseMaps2024_global_monthly_tiles/', month, '-0362E-1229N.tif'))
r4 = terra::rast(paste0('PlanetBaseMaps2024_global_monthly_tiles/', month, '-0362E-1230N.tif'))
r = terra::mosaic(r1, r2, r3, r4) %>%
terra::RGB()
writeRaster(r, paste0('PlanetBaseMaps2024_global_monthly_mosaic/', month, '_stiched.tif'))
}
stich_monthy_tile('2501')
month = '2501'
r1 = terra::rast(paste0('PlanetBaseMaps2024_global_monthly_tiles/', month, '-0361E-1229N.tif'))
r2 = terra::rast(paste0('PlanetBaseMaps2024_global_monthly_tiles/', month, '-0361E-1230N.tif'))
r3 = terra::rast(paste0('PlanetBaseMaps2024_global_monthly_tiles/', month, '-0362E-1229N.tif'))
r4 = terra::rast(paste0('PlanetBaseMaps2024_global_monthly_tiles/', month, '-0362E-1230N.tif'))
r = terra::mosaic(r1, r2, r3, r4) %>%
terra::RGB()
r
?RGB
stich_monthy_tile = function(month) {
r1 = terra::rast(paste0('PlanetBaseMaps2024_global_monthly_tiles/', month, '-0361E-1229N.tif'))
r2 = terra::rast(paste0('PlanetBaseMaps2024_global_monthly_tiles/', month, '-0361E-1230N.tif'))
r3 = terra::rast(paste0('PlanetBaseMaps2024_global_monthly_tiles/', month, '-0362E-1229N.tif'))
r4 = terra::rast(paste0('PlanetBaseMaps2024_global_monthly_tiles/', month, '-0362E-1230N.tif'))
r = terra::mosaic(r1, r2, r3, r4) %>%
terra::RGB()
print(plotRGB(r))
}
for (month in c('2501', '2502', '2503', '2504', '2505', '2506', '2507', '2508', '2509', '2510', '2511', '2512')) {
stich_monthy_tile(month)
}
stich_monthy_tile = function(month) {
r1 = terra::rast(paste0('PlanetBaseMaps2024_global_monthly_tiles/', month, '-0361E-1229N.tif'))
r2 = terra::rast(paste0('PlanetBaseMaps2024_global_monthly_tiles/', month, '-0361E-1230N.tif'))
r3 = terra::rast(paste0('PlanetBaseMaps2024_global_monthly_tiles/', month, '-0362E-1229N.tif'))
r4 = terra::rast(paste0('PlanetBaseMaps2024_global_monthly_tiles/', month, '-0362E-1230N.tif'))
r = terra::mosaic(r1, r2, r3, r4)
print(plotRGB(r))
}
for (month in c('2501', '2502', '2503', '2504', '2505', '2506', '2507', '2508', '2509', '2510', '2511', '2512')) {
stich_monthy_tile(month)
}
stich_monthy_tile = function(month) {
r1 = terra::rast(paste0('PlanetBaseMaps2024_global_monthly_tiles/', month, '-0361E-1229N.tif'))
r2 = terra::rast(paste0('PlanetBaseMaps2024_global_monthly_tiles/', month, '-0361E-1230N.tif'))
r3 = terra::rast(paste0('PlanetBaseMaps2024_global_monthly_tiles/', month, '-0362E-1229N.tif'))
r4 = terra::rast(paste0('PlanetBaseMaps2024_global_monthly_tiles/', month, '-0362E-1230N.tif'))
r = terra::mosaic(r1, r2, r3, r4)
return(r)
}
for (month in c('2501', '2502', '2503', '2504', '2505', '2506', '2507', '2508', '2509', '2510', '2511', '2512')) {
plot(stich_monthy_tile(month))
}
stich_monthy_tile = function(month) {
r1 = terra::rast(paste0('PlanetBaseMaps2024_global_monthly_tiles/', month, '-0361E-1229N.tif'))
r2 = terra::rast(paste0('PlanetBaseMaps2024_global_monthly_tiles/', month, '-0361E-1230N.tif'))
r3 = terra::rast(paste0('PlanetBaseMaps2024_global_monthly_tiles/', month, '-0362E-1229N.tif'))
r4 = terra::rast(paste0('PlanetBaseMaps2024_global_monthly_tiles/', month, '-0362E-1230N.tif'))
r = terra::mosaic(r1, r2, r3, r4)
return(r)
}
for (month in c('2501', '2502', '2503', '2504', '2505', '2506', '2507', '2508', '2509', '2510', '2511', '2512')) {
plotRBG(stich_monthy_tile(month))
}
stich_monthy_tile = function(month) {
r1 = terra::rast(paste0('PlanetBaseMaps2024_global_monthly_tiles/', month, '-0361E-1229N.tif'))
r2 = terra::rast(paste0('PlanetBaseMaps2024_global_monthly_tiles/', month, '-0361E-1230N.tif'))
r3 = terra::rast(paste0('PlanetBaseMaps2024_global_monthly_tiles/', month, '-0362E-1229N.tif'))
r4 = terra::rast(paste0('PlanetBaseMaps2024_global_monthly_tiles/', month, '-0362E-1230N.tif'))
r = terra::mosaic(r1, r2, r3, r4)
return(r)
}
for (month in c('2501', '2502', '2503', '2504', '2505', '2506', '2507', '2508', '2509', '2510', '2511', '2512')) {
terra::plotRGB(stich_monthy_tile(month))
}
library(terra)
library(tidyverse)
setwd("~/Desktop/NPS/SpectralUnmixing/ExploratoryJOTR")
stich_monthy_tile = function(month) {
r1 = terra::rast(paste0('PlanetBaseMaps2024_global_monthly_tiles/', month, '-0361E-1229N.tif'))
r2 = terra::rast(paste0('PlanetBaseMaps2024_global_monthly_tiles/', month, '-0361E-1230N.tif'))
r3 = terra::rast(paste0('PlanetBaseMaps2024_global_monthly_tiles/', month, '-0362E-1229N.tif'))
r4 = terra::rast(paste0('PlanetBaseMaps2024_global_monthly_tiles/', month, '-0362E-1230N.tif'))
r = terra::mosaic(r1, r2, r3, r4)
return(r)
}
for (month in c('2501', '2502', '2503', '2504', '2505', '2506', '2507', '2508', '2509', '2510', '2511', '2512')) {
r = stich_monthy_tile(month)
plotRGB(r)
}
library(terra)
library(tidyverse)
setwd("~/Desktop/NPS/SpectralUnmixing/ExploratoryJOTR")
stich_monthy_tile = function(month) {
r1 = terra::rast(paste0('PlanetBaseMaps2024_global_monthly_tiles/', month, '-0361E-1229N.tif'))
r2 = terra::rast(paste0('PlanetBaseMaps2024_global_monthly_tiles/', month, '-0361E-1230N.tif'))
r3 = terra::rast(paste0('PlanetBaseMaps2024_global_monthly_tiles/', month, '-0362E-1229N.tif'))
r4 = terra::rast(paste0('PlanetBaseMaps2024_global_monthly_tiles/', month, '-0362E-1230N.tif'))
r = terra::mosaic(r1, r2, r3, r4)
#writeRaster(r, paste0('PlanetBaseMaps2024_global_monthly_mosaic/', month, '_stiched.tif'))
return(r)
}
for (month in c('2501', '2502', '2503', '2504', '2505', '2506', '2507', '2508', '2509', '2510', '2511', '2512')) {
r = stich_monthy_tile(month)
plotRGB(r)
}
library(terra)
library(tidyverse)
library(sf)
setwd("~/Desktop/NPS/SpectralUnmixing/ExploratoryJOTR")
month = '2501'
alliances  = st_read('jotrgeodata.gpkg', layer = 'JOTR_VegPolys', quiet = T) %>%
filter(MapUnit_Name == "Red Brome - Mediterranean Grass Semi-Natural Herbaceous Stands") %>%
terra::vect()
plot(alliances)
alliances  = st_read('jotrgeodata.gpkg', layer = 'JOTR_VegPolys', quiet = T) %>%
filter(MapUnit_Name == "Red Brome - Mediterranean Grass Semi-Natural Herbaceous Stands") %>%
terra::vect()
r = stich_monthy_tile(month)
stich_monthy_tile = function(month) {
r1 = terra::rast(paste0('PlanetBaseMaps2024_global_monthly_tiles/', month, '-0361E-1229N.tif'))
r2 = terra::rast(paste0('PlanetBaseMaps2024_global_monthly_tiles/', month, '-0361E-1230N.tif'))
r3 = terra::rast(paste0('PlanetBaseMaps2024_global_monthly_tiles/', month, '-0362E-1229N.tif'))
r4 = terra::rast(paste0('PlanetBaseMaps2024_global_monthly_tiles/', month, '-0362E-1230N.tif'))
r = terra::mosaic(r1, r2, r3, r4)
#writeRaster(r, paste0('PlanetBaseMaps2024_global_monthly_mosaic/', month, '_stiched.tif'))
return(r)
}
r = stich_monthy_tile(month)
p = crop(alliances, r)
plot(p)
plotRGB(r)
lines(alliances, lwd=2, col="red")
plot(alliances)
alliances  = st_read('jotrgeodata.gpkg', layer = 'JOTR_VegPolys', quiet = T) %>%
filter(MapUnit_Name == "Red Brome - Mediterranean Grass Semi-Natural Herbaceous Stands") %>%
st_transform(4326) %>%
terra::vect()
plot(alliances)
plotRGB(r)
lines(alliances, lwd=2, col="red")
alliances = terra::project(alliances, r)
plotRGB(r)
lines(alliances, lwd=2, col="red")
plot(alliances)
r
alliances  = st_read('jotrgeodata.gpkg', layer = 'JOTR_VegPolys', quiet = T) %>%
filter(MapUnit_Name == "Red Brome - Mediterranean Grass Semi-Natural Herbaceous Stands") %>%
terra::vect()
plotRGB(r)
lines(alliances, lwd=1, col="red")
alliances  = st_read('jotrgeodata.gpkg', layer = 'JOTR_VegPolys', quiet = T) %>%
filter(MapUnit_Name == "Red Brome - Mediterranean Grass Semi-Natural Herbaceous Stands") %>%
terra::vect()
r = stich_monthy_tile(month)
r = stich_monthy_tile(month)
alliances = terra::project(alliances, r)
plotRGB(r)
lines(alliances, lwd=1, col="red")
alliances  = st_read('jotrgeodata.gpkg', layer = 'JOTR_VegPolys', quiet = T) %>%
filter(MapUnit_Name == "Red Brome - Mediterranean Grass Semi-Natural Herbaceous Stands")
View(alliances)
alliances  = st_read('jotrgeodata.gpkg', layer = 'JOTR_VegPolys', quiet = T) %>%
filter(MapUnit_Name == "Red Brome - Mediterranean Grass Semi-Natural Herbaceous Stands",
Poly_ID == 2825) %>%
terra::vect()
alliances  = st_read('jotrgeodata.gpkg', layer = 'JOTR_VegPolys', quiet = T) %>%
filter(MapUnit_Name == "Red Brome - Mediterranean Grass Semi-Natural Herbaceous Stands",
Poly_ID == 2825) %>%
terra::vect()
plot(alliances, col = "red", lwd = 0.5, border = "black")
alliances  = st_read('jotrgeodata.gpkg', layer = 'JOTR_VegPolys', quiet = T) %>%
filter(MapUnit_Name == "Red Brome - Mediterranean Grass Semi-Natural Herbaceous Stands",
Poly_ID == 2825) %>%
terra::vect()
stich_monthy_tile = function(month) {
r1 = terra::rast(paste0('PlanetBaseMaps2024_global_monthly_tiles/', month, '-0361E-1229N.tif'))
r2 = terra::rast(paste0('PlanetBaseMaps2024_global_monthly_tiles/', month, '-0361E-1230N.tif'))
r3 = terra::rast(paste0('PlanetBaseMaps2024_global_monthly_tiles/', month, '-0362E-1229N.tif'))
r4 = terra::rast(paste0('PlanetBaseMaps2024_global_monthly_tiles/', month, '-0362E-1230N.tif'))
r = terra::mosaic(r1, r2, r3, r4)
#writeRaster(r, paste0('PlanetBaseMaps2024_global_monthly_mosaic/', month, '_stiched.tif'))
return(r)
}
for (month in c('2501', '2502', '2503', '2504', '2505', '2506', '2507', '2508', '2509', '2510', '2511', '2512')) {
r = stich_monthy_tile(month)
alliances = terra::project(alliances, r)
plotRGB(crop(r, alliances))
lines(alliances, lwd=0.5, col="red")
}
install.packages("ellmer")
setwd("~/Desktop/TidyTuesday")
library(tidyverse)
library(sf)
library(scico)
tuesdata = tidytuesdayR::tt_load('2025-10-14')
food_security = tuesdata$food_security
rail_data = food_security %>%
filter(Item == "Rail lines density (total route in km per 100 square km of land area)",
Area %in% c("Northern America",
"Northern Europe", "Western Europe", "Eastern Europe", "Southern Europe",
"Western Asia and Northern Africa", "Central Asia", "Southern Asia",
"Eastern Asia"))
rail_data$Area = factor(rail_data$Area, levels = c("Northern America",
"Northern Europe", "Western Europe", "Eastern Europe", "Southern Europe",
"Western Asia and Northern Africa", "Central Asia", "Southern Asia",
"Eastern Asia"))
ggplot() + theme_classic() +
ggtitle('Railroad tracks around the world') +
geom_line(data = rail_data, aes(x = Year_Start, y = Value, color = Area)) +
geom_point(data = rail_data, aes(x = Year_Start, y = Value, color = Area), shape = 21, size = 2, fill = '#f4f1ee') +
geom_point(data = rail_data, aes(x = Year_Start, y = Value, color = Area), shape = 20, size = 1.5) +
scale_x_continuous(expand = c(.05, .05), name = 'Year') +
scale_y_continuous(expand = c(.05, .05), name = 'km per 100 square km of land area') +
scale_color_manual(name = 'Region',
values = c("Northern America" ='#001219',
"Northern Europe" = '#005f73',
"Western Europe" = '#0a9396',
"Eastern Europe" = '#94d2bd',
"Southern Europe" = '#e9d8a6',
"Western Asia and Northern Africa" = '#ee9b00',
"Central Asia" = '#ca6702',
"Southern Asia" = '#bb3e03',
"Eastern Asia" = '#ae2012')) +
theme(text = element_text(size = 15, color = 'grey20'),
legend.background = element_rect(fill='#f4f1ee', color = NA),
legend.box.background = element_rect(fill='#f4f1ee', color = NA),
panel.background = element_rect(fill = '#f4f1ee', colour = NA),
plot.background = element_rect(fill = '#f4f1ee', colour = NA),
strip.background = element_rect(fill = '#f4f1ee', color = NA),
axis.line.y = element_blank(),
axis.line.x = element_line(color = 'grey20', linewidth = 0.25),
axis.ticks = element_blank(),
axis.title = element_text(size = 13),
axis.text = element_text(color = 'grey20'),
panel.grid.major.y = element_line(color = 'grey20', linewidth = 0.15))
ggsave('251014.png', width = 8, height = 5, dpi = 300)
